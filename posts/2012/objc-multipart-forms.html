<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sending Multipart Forms with Objective-C</title>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/stylesheets/screen.css">
</head>
<body class="inner">

<header>   <h1><a href="/">Nathan Borror</a></h1> </header>

<article>

<p><strong>Sending Multipart Forms with Objective-C</strong> — It took me a few evenings to figure this out<sup><a href="#citation_01">1</a></sup> so I'm writing a quick explanation based on what I've found to work. My use-case is pretty simple, I want to POST some data to a form on a server from an iOS app I'm building. I'll be using NSURLRequest to build the request object and NSURLConnection to make the actual connection to the server.</p>
<p>The first thing we need to understand is how Multipart Form requests should be structured. The <a href="http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html">spec document</a> explains these in detail so I'm just going to show at a high level how this is structured. To get started lets create an NSMutableURLRequest:</p>

<script src="https://gist.github.com/nathanborror/311d0597cd54601aabcb27c96b4d5f22.js"></script>

<p>Now we need to define the content-type and a boundary string. I'm not really sure what a boundary string is, it just needs to be consistently represented throughout the request.</p>

<pre><code>Content-Type: multipart/form-data; boundary=YOUR_BOUNDARY_STRING</code></pre>

<p>To do this in objective-c we need to write the following:</p>

<script src="https://gist.github.com/nathanborror/701ebf558a62d98795ffffef6f72ccd3.js"></script>

<p>Now let's get look at the request body. Here's a simple example of how it needs to look to the server:</p>

<script src="https://gist.github.com/nathanborror/4777e572f77ba638052f8749fbff4a5d.js"></script>

<p>I'm sending over three variables: an image named photo, a string named message, and an integer named user. It's important to note the linebreaks and the dashes before the boundary string. These must be included in order to build a good request. Now lets write some objective-c:</p>

<script src="https://gist.github.com/anonymous/aa97fcb74c6111c9a5e0f9798a049304.js"></script>

<p>Now all we need to do is make a connection to the server and send the request:</p>

<script src="https://gist.github.com/nathanborror/48cf887355790c0fbaaeec19c09f9f43.js"></script>

<p>That's it. A more detailed explanation of the request formatting can be found <a href="http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html">here</a>.</p>
<p><em>If you're curious, I'm posting to a Django app I was running locally so I could use <a href="http://pypi.python.org/pypi/ipdb">ipdb</a> and <a href="http://ipython.org">iPython</a> to inspect the process and see what my app was posting. Then I compared that to a post request generated by a testcase I knew worked.</em></p>
<footer><p><small>September 12, 2012 around 11pm</small></p></footer>

</article>

</body>
</html>
