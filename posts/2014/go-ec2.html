<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Deploying a Go project on EC2</title>
  <meta name="keywords" content="nathan borror, san francisco, ios, swift, django, objective-c, palo alto, design, product design, interaction, engineer, technology">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/stylesheets/screen.css">
</head>
<body class="inner">

<header>   <h1><a href="/">Nathan Borror</a></h1> </header>

<article>
<h1>Deploying a Go project on EC2</h1>

<p>I’ve been playing around with Go lately and spent a few hours figuring out how to deploy a project on Amazon EC2. I’m going to walk you through the steps I took to hopefully save you time if you’re a first time Go/EC2 user like myself.</p>

<h2>Launch new EC2 instance</h2>

<p>First thing you’ll need is an EC2 instance where you can put all your stuff:</p>

<ol>
<li>Go <a href="https://console.aws.amazon.com/">here</a></li>
<li>Choose <strong>EC2</strong> and click <strong>Launch Instance</strong></li>
<li>Select <strong>Ubuntu Server</strong></li>
<li>Micro instance should already be selected so just click Review and Launch</li>
<li>Click Launch</li>
<li>If you don’t have an existing key pair, choose Create new key pair. Give it a name and click Download Key Pair. This will give you a .pem.txt file which you should then move into your ~/.ssh folder and remove the .txt extension.</li>
<li>Run chmod 400 your-key-pair.pem to make sure your private key isn’t publicly viewable.</li>
<li>(optional) To make life easier add the following to your .ssh/config file</li>
</ol>

<p><code>
Host e
HostName 54.208.83.100
User ubuntu
IdentityFile ~/.ssh/your-key-pair.pem
</code></p>

<p>This makes it so you can just type ssh e to login to your EC2 instance without having to type ssh -i your-key-pair.pem ubuntu@54.208.83.100. Also remember to replace the 54.208.83.100 with the public IP address of your EC2 instance.</p>

<h2>Preparing the EC2 instance</h2>

<p>Now lets install all the software we need to make our Go project work:</p>

<ol>
<li>Run sudo apt-get install build-essential golang git mercurial</li>
<li>If you’re project is using anything else you’ll need to install it. I like to use sqlite so I also ran sudo apt-get install sqlite3.</li>
<li>Set your GOPATH by opening your .profile file with your editor of choice. For simplicity just add export GOPATH=$HOME/go to the bottom of the file. Save the file and run source ~/.profile to pick up the changes.</li>
<li>If your Go project is on Github all you’ll need to do is run go get github.com/your-username/your-project-name and Go will install everything in your ~/go directory.</li>
<li>Navigate to your project folder cd ~/go/src/github.com/your-username/your-project-name and type go build to build your project. Then you can try running it by typing ./project-name. Now we need to hop back over to the Amazon console.</li>
</ol>

<h2>Editing security groups</h2>

<p>By default Amazon does not allow incoming web traffic so we need to open up ports 80 (and 8080 to test our Go project). To do this we need to open up the EC2 Dashboard and click Instances in the left sidebar. Choose your instance and click the item (i.e. launch-wizard*) right next to Security groups. This will take you to the Security Groups section.</p>

<p>Click the Inbound tab at the bottom and click the Edit button. Click Add Rule and choose HTTP from the menu on the left. Click Add Rule again and this time keep Custom TCP Rule and change Port Range to 8080. Click Save.</p>

<p>If you kept your project running from step 5 of the last section you should be able to navigate to port 8080 of your instance’s public IP address in your browser and see your project working.</p>

<p>We’re almost done. At this point if we logout of our shell the program will terminate. Using Upstart we can ensure our program is running at all times.</p>

<h2>Running our program with Upstart</h2>

<p>First lets create a new file in the /etc/init/ folder called project-name.conf. Open it in your favorite editor and add the following:</p>

<p><code>``
description “start and stop the go program ‘my-project</code>”</p>

<p>start on filesystem or runlevel [2345]
stop on runlevel [!2345]</p>

<p>env USER=’ubuntu’
env APP<em>DIR=’/home/ubuntu/go/src/github.com/your-username/your-project-name/’
env APP</em>EXEC=‘your-project-name’</p>

<p>exec start-stop-daemon —start —chuid ${USER} —chdir ${APP<em>DIR} —exec ${APP</em>DIR}${APP_EXEC}
```</p>

<p>Now run sudo start your-project-name to get your program up and running. You should now be able to close your shell and still view the project in your browser from anywhere.</p>

<p>That's it!</p>

<p><em>Originally posted on <a href="https://medium.com/@nathanborror/deploying-a-go-project-on-ec2-15ce381cf7a1">Medium</a> June 8, 2014 around 9pm</em></p>
</article>

</body>
</html>
